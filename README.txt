Repository pattern is good for DRY. 

Though, there are some flaws in the code described below:

Data validation is missing and confused. 
Error handling is very poor. 
Too much nested checks. 
Lengthy functions.

Queries result are not evaluated. Consequently they can produce error at allot of places. 
I fixed some of them to work within the specified time.